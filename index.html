<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyScript Sequence Prediction</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.11.2/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.11.2/core.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #output { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        label { display: block; margin: 10px 0; }
        input, button { padding: 5px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Sequence Prediction with PyScript</h1>
    <div>
        <label for="sequence">Enter sequence (comma-separated numbers):</label>
        <input type="text" id="sequence" value="1,0,2,15,3,6,4,6,5,15,6,6,7,12,1,0,2,15,3,6,4,6,5,15,6,6,7,12,1,0,2,15,3,6,4,6,5,15,6,6,7,12,1,0,2,15,3,6,4,6,5,15,6,6,7,12,1,2,7,12,5,14,2,13,2,12,3,6,5,15,2,13,5,15,7,12">
        <label for="window_size">Window Size:</label>
        <input type="number" id="window_size" value="3" min="1">
        <button onclick="runPrediction()">Predict</button>
    </div>
    <div id="output">Results will appear here...</div>

    <py-config>
        packages = ["numpy", "scikit-learn"]
    </py-config>

    <py-script>
        import numpy as np
        from sklearn.ensemble import RandomForestRegressor
        from sklearn.model_selection import train_test_split, cross_val_score
        from sklearn.metrics import mean_squared_error
        from pyscript import document, window

        def run_prediction(*args, **kwargs):
            try:
                # Get inputs from HTML form
                sequence_input = document.querySelector("#sequence").value
                window_size = int(document.querySelector("#window_size").value)

                # Parse sequence
                sequence = np.array([float(x.strip()) for x in sequence_input.split(",")])

                # Validate inputs
                if len(sequence) < window_size + 1:
                    document.querySelector("#output").innerHTML = "Error: Sequence too short for the given window size."
                    return

                # Create X and y
                X, y = [], []
                for i in range(len(sequence) - window_size):
                    X.append(sequence[i:i+window_size])
                    y.append(sequence[i+window_size])
                X = np.array(X)
                y = np.array(y)

                # Train model with cross-validation
                model = RandomForestRegressor(n_estimators=100, random_state=42)
                scores = cross_val_score(model, X, y, cv=5, scoring='neg_mean_squared_error')
                mse = -scores.mean()

                # Train final model on all data for prediction
                model.fit(X, y)

                # Predict next number
                last_window = sequence[-window_size:]
                next_number = model.predict([last_window])[0]

                # Output results
                output_div = document.querySelector("#output")
                output_div.innerHTML = (
                    f"Cross-Validated Mean Squared Error: {mse:.4f}<br>"
                    f"Predicted Next Number: {next_number:.2f}"
                )
            except Exception as e:
                document.querySelector("#output").innerHTML = f"Error: {str(e)}"

        # Bind the function to the button
        document.querySelector("button").onclick = run_prediction
    </py-script>
</body>
</html>
